<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker - All Expenses</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
  </head>
  <body>
    <div class="container">
      <!-- Header Section -->
      <header>
        <h1>üí∞ Expense Tracker</h1>
        <p class="subtitle">Track and manage your expenses efficiently</p>
      </header>

      <!-- Success/Error Messages -->
      <div
        th:if="${successMessage}"
        class="alert alert-success"
        th:text="${successMessage}"
      ></div>
      <div
        th:if="${errorMessage}"
        class="alert alert-error"
        th:text="${errorMessage}"
      ></div>

      <!-- Action Bar -->
      <div class="action-bar">
        <a th:href="@{/expenses/new}" class="btn btn-primary"
          >‚ûï Add New Expense</a
        >

        <!-- Search Form -->
        <form th:action="@{/expenses/list}" method="get" class="search-form">
          <input
            type="text"
            name="search"
            placeholder="Search description..."
            th:value="${currentSearch}"
            class="search-input"
          />
          <button type="submit" class="btn btn-secondary">üîç Search</button>
          <a th:href="@{/expenses/list}" class="btn btn-link">Clear</a>
        </form>
      </div>

      <!-- Category Filter -->
      <div class="filter-bar">
        <label>Filter by Category:</label>
        <a
          th:href="@{/expenses/list}"
          class="filter-btn"
          th:classappend="${currentCategory == null} ? 'active' : ''"
        >
          All
        </a>
        <a
          th:href="@{/expenses/list(category='Food')}"
          class="filter-btn"
          th:classappend="${currentCategory == 'Food'} ? 'active' : ''"
        >
          Food
        </a>
        <a
          th:href="@{/expenses/list(category='Transport')}"
          class="filter-btn"
          th:classappend="${currentCategory == 'Transport'} ? 'active' : ''"
        >
          Transport
        </a>
        <a
          th:href="@{/expenses/list(category='Entertainment')}"
          class="filter-btn"
          th:classappend="${currentCategory == 'Entertainment'} ? 'active' : ''"
        >
          Entertainment
        </a>
        <a
          th:href="@{/expenses/list(category='Shopping')}"
          class="filter-btn"
          th:classappend="${currentCategory == 'Shopping'} ? 'active' : ''"
        >
          Shopping
        </a>
        <a
          th:href="@{/expenses/list(category='Bills')}"
          class="filter-btn"
          th:classappend="${currentCategory == 'Bills'} ? 'active' : ''"
        >
          Bills
        </a>
        <a
          th:href="@{/expenses/list(category='Other')}"
          class="filter-btn"
          th:classappend="${currentCategory == 'Other'} ? 'active' : ''"
        >
          Other
        </a>
      </div>

      <!-- Expenses Table -->
      <div class="table-container">
        <table
          class="expenses-table"
          th:if="${expenses != null and !expenses.isEmpty()}"
        >
          <thead>
            <tr>
              <th>ID</th>
              <th>Transaction Date</th>
              <th>Name</th>
              <th>Amount</th>
              <th>Category</th>
              <th>Tag</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="expense : ${expenses}">
              <td th:text="${expense.id}">1</td>
              <td
                th:text="${#temporals.format(expense.transactionDate, 'MMM dd, yyyy HH:mm')}"
              >
                Jan 01, 2024 12:00
              </td>
              <td th:text="${expense.name}">Grocery Shopping</td>
              <td
                class="amount"
                th:text="'$' + ${#numbers.formatDecimal(expense.amount, 1, 2)}"
              >
                $50.00
              </td>
              <td>
                <span
                  class="badge"
                  th:text="${expense.category}"
                  th:classappend="${expense.category}"
                  >Food</span
                >
              </td>
              <td>
                <span
                  class="badge"
                  th:text="${expense.tag != null ? expense.tag : 'N/A'}"
                  >Personal</span
                >
              </td>
              <td class="actions">
                <a
                  th:href="@{/expenses/edit/{id}(id=${expense.id})}"
                  class="btn-action btn-edit"
                  >‚úèÔ∏è Edit</a
                >
                <a
                  th:href="@{/expenses/delete/{id}(id=${expense.id})}"
                  class="btn-action btn-delete"
                  onclick="return confirm('Are you sure you want to delete this expense?')"
                >
                  üóëÔ∏è Delete
                </a>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Empty State -->
        <div
          class="empty-state"
          th:if="${expenses == null or expenses.isEmpty()}"
        >
          <p>üìã No expenses found.</p>
          <p th:if="${currentSearch != null or currentCategory != null}">
            Try adjusting your filters or
            <a th:href="@{/expenses/list}">view all expenses</a>.
          </p>
          <p th:if="${currentSearch == null and currentCategory == null}">
            <a th:href="@{/expenses/new}" class="btn btn-primary"
              >Add your first expense</a
            >
          </p>
        </div>
      </div>

      <!-- Summary Section -->
      <div class="summary" th:if="${expenses != null and !expenses.isEmpty()}">
        <h3>Summary</h3>
        <p>
          <strong>Total Expenses:</strong>
          <span th:text="${expenses.size()}">0</span>
        </p>
        <p>
          <strong>Total Amount:</strong>
          <span
            class="amount"
            th:text="'$' + ${#aggregates.sum(expenses.![amount])}"
            >$0.00</span
          >
        </p>
      </div>

      <!-- Footer -->
      <footer>
        <p>&copy; 2024 Expense Tracker | Built with Spring Boot & Thymeleaf</p>
      </footer>
    </div>
  </body>
</html>
